# 🤖 لیگ‌پیشگو — ربات تلگرام پیش‌بینی لیگ برتر ایران

یک بات تلگرامی ساده و سریع برای پیش‌بینی نتایج لیگ برتر ایران (۳۰ هفته) با امتیازدهی خودکار و جدول رده‌بندی.  
زبان رابط کاربری: فارسی — دیتابیس: SQLite — فریم‌ورک: [python-telegram-bot 20+].

---

## ✨ امکانات
- ثبت پیش‌بینی هر بازی با دکمه‌های آماده یا ورودی دستی
- امتیازدهی خودکار بعد از ثبت نتایج واقعی (۵ امتیاز نتیجه دقیق، ۳ امتیاز برنده صحیح، ۱ امتیاز جزئی)
- جدول رده‌بندی کلی و هفتگی
- کش هفته فعلی برای کاهش فشار دیتابیس
- دستورات مدیر برای آغاز هفته جدید و ثبت نتایج

## 📦 ساختار اصلی
```
bot.py           # هندلرها و راه‌اندازی اپ
config.py        # تنظیمات و خواندن ENV
database.py      # لایه دسترسی به دیتابیس
init_db.py       # ساخت دیتابیس و ایمپورت برنامه مسابقات
matches_data.json# برنامه 30 هفته
.env.sample      # نمونه متغیرهای محیطی
```

## 🚀 راه‌اندازی سریع
1) کلون/کپی پروژه و ساخت محیط مجازی
```bash
python -m venv .venv && source .venv/bin/activate   # ویندوز: .venv\Scripts\activate
pip install -r requirements.txt
```

2) ساخت فایل ENV
```bash
cp .env.sample .env
# سپس BOT_TOKEN و ADMIN_IDS را در .env پر کنید
```

3) ساخت دیتابیس و ایمپورت بازی‌ها
```bash
python init_db.py
# فایل bot.db ساخته می‌شود و هفته ۱ ست می‌گردد
```

4) اجرای بات
```bash
python bot.py
```

## 🧪 دستورات ربات
- کاربر:
  - `/start` شروع پیش‌بینی بازی بعدی هفته
  - `/mybets [week]` لیست پیش‌بینی‌های کاربر (اختیاری: فیلتر هفته)
  - `/matches` بازی‌های هفته جاری
  - `/week` شماره هفته فعلی
  - `/champion [week]` جدول امتیازات (کلی یا هفتگی)
  - `/helpme` راهنما

- مدیر:
  - `/setresult` ثبت نتیجه واقعی هر بازی (با گفت‌وگو/کیبورد)
  - `/startweek` اعلام برنامه هفته جاری
  - `/nextweek` افزایش هفته فعلی

> نکته: برای تشخیص مدیر بودن، آی‌دی کاربر باید در `ADMIN_IDS` قرار داشته باشد.

## 🔐 نکات امنیتی مهم
- **فایل `.env` و `bot.db` را هرگز به گیت اضافه نکنید** (در `.gitignore` لحاظ شده).
- توکن ربات (BOT_TOKEN) را محرمانه نگه دارید و در صورت افشا، از BotFather توکن جدید بگیرید.
- در صورت دیپلوی روی سرور، از `systemd`/`pm2` یا Docker برای سرویس پایدار استفاده کنید.

## 🛠️ تنظیمات محیطی
فایل `.env`:
```
BOT_TOKEN=YOUR_TELEGRAM_BOT_TOKEN
ADMIN_IDS=123456789,987654321
# DATABASE_PATH=bot.db   # اختیاری
```

> در حال حاضر مسیر دیتابیس پیش‌فرض داخل کد `database.py` برابر `bot.db` است. در صورت نیاز می‌توانید آن را بر اساس ENV قابل‌پیکربندی کنید.

## 🧩 نکات کدنویسی/ایمنی
- در `config.py` اگر `ADMIN_IDS` ست نشده باشد، تبدیل مستقیم `split(",")` خطا می‌دهد. پیشنهاد:
```python
raw_admins = os.getenv("ADMIN_IDS", "").strip()
ADMIN_IDS = [int(x) for x in raw_admins.split(",") if x.strip().isdigit()]
```
- برای Production پیشنهاد می‌شود `DEFAULT_SCORES` را کامل‌تر کنید و محدودیت طول نتیجه (`MAX_SCORE_LENGTH`) را متناسب نیاز تغییر دهید.

## 🗂️ مجوز
MIT (اختیاری: بر اساس نیاز خود تغییر دهید)

---

ساخته شده با ❤ برای فوتبال‌دوست‌ها. اگر به نسخه انگلیسی README نیاز دارید، Issue بزنید.
